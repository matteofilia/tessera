<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
		<title>Tessera Programming Language</title>
		<link rel="stylesheet" href="styles.css">
		<script
			  src="https://code.jquery.com/jquery-3.7.1.min.js"
			  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
			  crossorigin="anonymous"></script>
		<script>
			$(document).ready(function() {
				var counter = 0;
				var total_files = 10;
				var counter_secret = 0;
				var total_secret_files = 4;

				var API_URL = "http://localhost:8080"
				
				load_file = function() {
					index = (counter % total_files)+1
					example_url = "public/code_examples/example"+index+".tess"
					
					$.ajax({
						url : example_url,
						dataType: "text",
						success : function(data) {
							$("#input-box").val(data);
						}
					});
				}
				
				$("#button-next").click(function(){
					counter = counter+1;
					load_file()
				})
		
				$("#button-previous").click(function(){
					counter = counter-1;
					load_file()
				});
				
				$("#button-run-code").click(function(){
					// Clear Box
					$("#output-box").text("working...");
					
					// Show Loading Logo
					// TODO: can this be done in a better way?
					$("#loading-logo").show();
					$("#loading-logo").fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
					
					var req_url = API_URL+"/run";
					
					req_url += "?runLexer="+$("#button-run-lexer").is(":checked");
					req_url += "&runParser="+$("#button-run-parser").is(":checked");
					req_url += "&runInterpreter="+$("#button-run-interpreter").is(":checked");
					
					req_url += "&beVerbose="+$("#button-be-verbose").is(":checked");
					req_url += "&beVeryVerbose="+$("#button-be-very-verbose").is(":checked");
					req_url += "&displayAsciiArt="+$("#button-display-ascii-art").is(":checked");
					
					var data = $("#input-box").val();
					console.log("Sending POST request to "+req_url +" with data "+data);

					$.ajax({
						type: "POST",
						url: req_url,
						data: data,
						contentType: 'text/plain',
						timeout: 10000,
						success: function(data) {
							$("#output-box").text(data);
							$("#loading-logo").stop(true, true).hide();
						},
						error: function(xhr, status, error) {
							if (status === "timeout") {
								$("#output-box").text("Request Timeout");
								$("#loading-logo").stop(true, true).hide();
							} else {
								$("#output-box").text("Error");
								$("#loading-logo").stop(true, true).hide();
							}
						}
					});
				});
				
				$("#popup-close-button").click(function(){
					$("#popup").hide();
				})
				
				$("#settings-popup-close-button").click(function(){
					$("#settings-popup").hide();
				})
				
				$("#button-open-settings").click(function(){
					$("#settings-popup").show();
				})
				
				load_file_secret = function() {
					secret_index = (counter_secret % total_secret_files)+1
					example_url = "public/code_examples/example_secret"+secret_index+".tess"
					
					$.ajax({
						url : example_url,
						dataType: "text",
						success : function(data) {
							$("#input-box").val(data);
						}
					});
				}
				
				$("#logo").click(function() {
					counter_secret += 1;
					load_file_secret()
				})
				
				// By default, setting runInterpreter should ALSO enable runParser and runLexer
				$("#button-run-interpreter").on("change", function() {
					if (this.checked) {
						$("#button-run-lexer").prop("checked", true);
						$("#button-run-parser").prop("checked", true);
					}
				});
				
				$("#button-run-parser").on("change", function() {
					if (this.checked) {
						$("#button-run-lexer").prop("checked", true);
					} else {
						$("#button-run-interpreter").prop("checked", false);
					}
				});
				
				$("#button-run-lexer").on("change", function() {
					if (!this.checked) {
						$("#button-run-parser").prop("checked", false);
						$("#button-run-interpreter").prop("checked", false);
					}
				});
				
				$("#button-be-verbose").on("change", function() {
					if (!this.checked) {
						$("#button-be-very-verbose").prop("checked", false);
					}
				});
			
				
				$("#button-be-very-verbose").on("change", function() {
					if (this.checked) {
						$("#button-be-verbose").prop("checked", true);
					}
				});
			
				$("#settings-popup").hide();
				load_file()
			})
		</script>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
	
		<link rel="icon" type="image/png" sizes="32x32" href="public/tessera_logo_c.png">
	</head>

	<body>		
		<h1 id="title">Tessera</h1>
		<div id="popup">
			<div id="popup-header">
				<p id="popup-header-title">Notice</p>
				<p id="popup-close-button">x</p>
			</div>
			<div id="popup-container">
				<p id="popup-text">Tessera is a <span class="span-bold"> work in progress</span> programming language. Not all features have been currently implemented. You are free to try the language in its current state. <span class="span-newline">-Matteo</span></p>
			</div>
		</div>
		
		<div id="settings-popup">
			<div id="settings-popup-header">
				<p id="settings-popup-header-title">Settings</p>
				<p id="settings-popup-close-button">x</p>
			</div>
			<div id="settings-popup-container">
				<h3 class="cool-checkbox-header">GENERAL</h3>
				<label class="cool-checkbox">
			  		<input id="button-run-lexer" type="checkbox" checked> Run Lexer 
				</label>
					
				<label class="cool-checkbox">
			  		<input id="button-run-parser" type="checkbox" checked> Run Parser 
				</label>
					
				<label class="cool-checkbox">
			  		<input id="button-run-interpreter" type="checkbox" checked> Run Interpreter 
				</label>
				
				<br>
				<h3 class="cool-checkbox-header">DEBUG</h3>
				
				<label class="cool-checkbox">
			  		<input id="button-be-verbose" type="checkbox"> Be Verbose 
				</label>
				<label class="cool-checkbox">
			  		<input id="button-be-very-verbose"  type="checkbox"> Be Very Verbose 
				</label>
				
				<br>
				<h3 class="cool-checkbox-header">OTHER</h3>
				<label class="cool-checkbox">
			  		<input id="button-display-ascii-art"  type="checkbox"> Display ASCII Art 
				</label>
			</div>
		</div>
		
		<div id="content-holder">
			<div contenteditable="true">
				<p class="header">Input</p>
				<textarea id="input-box" rows="20" cols="50"></textarea>
				<div id="action-bar">
					<div id="navigation-controls">
						<input class="button" id="button-previous" type="button" value="Previous"/>
						<input class="button" id="button-next" type="button" value="Next"/>
					</div>
					<input class="button" id="button-run-code" type="button" value="Run Code"/>
				</div>
			</div>
			<div>
				<p class="header">Output</p>
				<div id="output-box-container">
					<div id="output-box"></div>
					<img id="loading-logo" alt="Tessera Logo" src="public/tessera_logo_c.png"/>
				</div>
				
				
				
				<div id="action-bar-2">
					<input class="button" id="button-open-settings" type="button" value="Open Settings"/>
				</div>
			</div>
		</div>
		<div id="bottom-content-holder">
			<a class='bottom-content-item' href="https://github.com/matteofilia/tessera">View on GitHub</a>
			<p class='bottom-content-item' id="version">ALPHA 0.1.3</p>
			<p class='bottom-content-item' id="label">Matteo's Programming Language</p>
		</div>
		
		<img id="logo" alt="Tessera Logo" src="public/tessera_logo_c.png"/>
		<p class="tip">Press Me!</p>
	</body>
</html>
