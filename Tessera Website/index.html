<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Tessera Programming Language</title>
		<link rel="stylesheet" href="styles.css">
		<script
			  src="https://code.jquery.com/jquery-3.7.1.min.js"
			  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
			  crossorigin="anonymous"></script>
		<script src="https://cjrtnc.leaningtech.com/2.3/loader.js"></script>
		<script>
			$(document).ready(function() {
				var counter = 0;
				var total_files = 4;

				var API_URL = "http://localhost:8080"
				
				load_file = function() {
					index = (counter % total_files)+1
					example_url = "public/code_examples/example"+index+".ts"
					
					$.ajax({
						url : example_url,
						dataType: "text",
						success : function(data) {
							$("#input-box").val(data);
						}
					});
				}
				
				$("#button-next").click(function(){
					counter = counter+1;
					load_file()
				})
		
				$("#button-previous").click(function(){
					counter = counter-1;
					load_file()
				});
				
				$("#button-run-code").click(function(){
					var req_url = API_URL+"/lex";
					var data = $("#input-box").val();
					console.log("Sending POST request to "+req_url +" with data "+data);

					$.ajax({
						type: "POST",
						url: req_url,
						data: data,
						contentType: 'text/plain'
					}).done(function(data) {
						$("#output-box").text(data);
					});
				});
				
				load_file()
			})
		</script>
		<script>
			(async function () {
				await cheerpjInit();
				await cheerpjRunJar(
					"app/main.jar",
					"--verbose", 
					"--web"
				);
				
			})();
		</script>
	</head>

	<body>
		<h1 id="title" class="test">Tessera</h1>
		<div id="content-holder">
			<div>
				<p class="header">Input</p>
				<textarea id="input-box" rows="20" cols="50"></textarea>
				<div id="action-bar">
					<div id="navigation-controls">
						<input class="button" id="button-previous" type="button" value="Previous"/>
						<input class="button" id="button-next" type="button" value="Next"/>
					</div>
					<input class="button" id="button-run-code" type="button" value="Run Code"/>
				</div>
			</div>
			<div>
				<p class="header">Output</p>
				<div id="output-box">
					<p id="output">Test</p>
				</div>
			</div>
		</div>
		<div id="bottom-content-holder">
			<a href="https://github.com/matteofilia/tessera">View on GitHub</a>
		</div>
	</body>
</html>
